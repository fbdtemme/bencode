

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Value interface &mdash; bencode 0.4.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="View interface" href="view.html" />
    <link rel="prev" title="Value and view types" href="value_and_view.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> bencode
          

          
            
            <img src="../_static/bencode.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/bencode_format.html">Bencode format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/integration.html">Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/performance.html">Performance</a></li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="value_and_view.html">Value and view types</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Value interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#construction">Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#type-checking">Type checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessors">Accessors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conversion">Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-operations">Modifying operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comparison">Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#policies">Policies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="view.html">View interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events system</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoding_decoding.html">Encoding and decoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptor.html">Descriptor</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization_points.html">User-defined type support</a></li>
<li class="toctree-l1"><a class="reference internal" href="trait_headers.html">Trait headers</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/bvalue.html">Value interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/bview.html">View interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/encoding_and_decoding.html">Encoding and decoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/descriptor_and_descriptor_table.html">Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/consumers.html">Event consumers</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/references.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">bencode</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Value interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/usage/value.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="value-interface">
<span id="bvalue"></span><h1>Value interface<a class="headerlink" href="#value-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> is class that represents a bencoded value.
<a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> can be used to create and edit bencode values.</p>
<p>It is a sum-type implemented with a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">std::variant</span></code>.</p>
<p>The possible alternative types stored in a <a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> are the bencode data types:
integer, string, list, dict, and a special uninitialized type.</p>
<p><a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> is an instantiation of the class template
<a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode12basic_bvalueE" title="bencode::basic_bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;typename</span> <span class="pre">Policy&gt;</span> <span class="pre">basic_bvalue</span></code></a> and the exact types used to store
the different bencode data types can be customized through the Policy template argument.</p>
<p>The default policy uses following storage types for the possible alternatives:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>integer</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">std::int64_t</span></code></p></td>
</tr>
<tr class="row-even"><td><p>string</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">std::string</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>list</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">std::vector</span></code></p></td>
</tr>
<tr class="row-even"><td><p>dict</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">std::map</span></code></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In most examples <a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> can be replaced by
<a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode12basic_bvalueE" title="bencode::basic_bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">basic_bvalue</span></code></a> with a user-defined Policy template argument.</p>
</div>
</div>
<div class="section" id="construction">
<h2>Construction<a class="headerlink" href="#construction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> provides similar constructors and assignment operators as <code class="code docutils literal notranslate"><span class="pre">std::variant</span></code>.</p>
<p>Construct an empty bvalue.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="p">{};</span>
</pre></div>
</div>
<p>Arguments matching one of the storage types will be forwarded to the constructor of the
underlying type.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Copy initialize an integer</span>
<span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">bi</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// Copy initialize a bvalue holding a string.</span>
<span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b3</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The type can be passed explicitly using one of the following type tags:</p>
<ul class="simple">
<li><p><code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">bc::btype::integer</span></code></p></li>
<li><p><code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">bc::btype::string</span></code></p></li>
<li><p><code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">bc::btype::list</span></code></p></li>
<li><p><code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">bc::btype::dict</span></code></p></li>
</ul>
<p>This is necessary to distinguish between initializer-lists for string, list and dict bencode types.
The constructor taking an initializer-list without a type tag will construct a dict.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// initialized-list without type-tag constructs a dict.</span>
<span class="k">auto</span> <span class="n">dict_from_init_list</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span><span class="p">({{</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">}});</span>

<span class="c1">// construct a vector of 5 times 1</span>
<span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b4</span><span class="p">(</span><span class="n">bc</span><span class="o">::</span><span class="n">btype</span><span class="o">::</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p>The converting constructor allow any type that has the required customization points implemented
to be passed to the bvalue constructor.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;bencode/traits/list.hpp&gt;</span><span class="cp"></span>

<span class="k">auto</span> <span class="n">l</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
<span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bencode</span><span class="o">::</span><span class="n">bvalue</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="type-checking">
<h2>Type checking<a class="headerlink" href="#type-checking" title="Permalink to this headline">¶</a></h2>
<p>Checking the alternative of a <a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a>
can be done using the following functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode13holds_integerEbRK12basic_bvalueI6PolicyE" title="template&lt;typename Policy&gt; bool holds_integer(const basic_bvalue&lt;Policy&gt;&amp;)"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_integer(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode12holds_stringEbRK12basic_bvalueI6PolicyE" title="template&lt;typename Policy&gt; bool holds_string(const basic_bvalue&lt;Policy&gt;&amp;)"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_string(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode10holds_listEbRK12basic_bvalueI6PolicyE" title="template&lt;typename Policy&gt; bool holds_list(const basic_bvalue&lt;Policy&gt;&amp;)"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_list(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/bvalue.html#_CPPv4I0EN7bencode10holds_dictEbRK12basic_bvalueI6PolicyE" title="template&lt;typename Policy&gt; bool holds_dict(const basic_bvalue&lt;Policy&gt;&amp;)"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_dict(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/bvalue.html#_CPPv4I_12bencode_type0EN7bencode17holds_alternativeEbRK12basic_bvalueI6PolicyE" title="template&lt;enum bencode_type E, typename Policy&gt; bool holds_alternative(const basic_bvalue&lt;Policy&gt;&amp;)"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;enum</span> <span class="pre">bencode_type</span> <span class="pre">E,</span> <span class="pre">typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_alternative(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></a></p></li>
<li><p><code class="xref cpp cpp-expr docutils literal notranslate"><span class="pre">template</span> <span class="pre">&lt;bview_alternative_type</span> <span class="pre">T,</span> <span class="pre">typename</span> <span class="pre">Policy&gt;</span> <span class="pre">bool</span> <span class="pre">holds_alternative(const</span> <span class="pre">basic_bvalue&lt;Policy&gt;&amp;)</span></code></p></li>
</ul>
<p>The <code class="code docutils literal notranslate"><span class="pre">holds_&lt;type&gt;</span></code> (where <code class="code docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> is one of the bencode data types)
functions are convenience functions that wrap the templated <code class="code docutils literal notranslate"><span class="pre">holds_alternative</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bencode</span><span class="o">::</span><span class="n">bvalue</span><span class="p">({{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">}});</span>

<span class="n">holds_integer</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>    <span class="c1">// returns false</span>
<span class="n">holds_dict</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>       <span class="c1">// returns true</span>

<span class="c1">// type tag based check</span>
<span class="n">bc</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">bc</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">dict</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// returns true</span>

<span class="c1">// bvalue access with the exact storage type.</span>
<span class="k">using</span> <span class="n">T</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">bv</span><span class="o">::</span><span class="n">bvalue</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">bc</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// returns true</span>
</pre></div>
</div>
</div>
<div class="section" id="accessors">
<h2>Accessors<a class="headerlink" href="#accessors" title="Permalink to this headline">¶</a></h2>
<p>Accessor functions are used to get access to the alternative types stored in a <a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a>.
Throwing accessor function will throw <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bad_bvalue_access</span></code> when the current
activate alternative type does not match the access type.</p>
<p>Non throwing accessor functions will return a pointer to the alternative type or a <code class="xref cpp cpp-expr docutils literal notranslate"><span class="pre">nullptr</span></code>.</p>
<p>The interface is similar to that of <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">std::variant</span></code>.
Except that there are aliases (eg. <code class="code docutils literal notranslate"><span class="pre">get_integer</span></code>, <code class="code docutils literal notranslate"><span class="pre">get_if_integer</span></code>) for all possible
alternative types.</p>
<p>Accessor functions documentation can be found <a class="reference internal" href="../reference/bvalue.html#bvalue-accessors"><span class="std std-ref">here</span></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span><span class="p">;</span>

<span class="k">using</span> <span class="n">bv</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bencode_type</span><span class="p">;</span>

<span class="c1">// access by enum / type tag</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">bc</span><span class="o">::</span><span class="n">btype</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// is equivalent to: get&lt;bc::bencode_type::string&gt;(b);</span>

<span class="c1">// access by exact alterantive type</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

<span class="c1">// or the more succinct version</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

<span class="k">auto</span><span class="o">&amp;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">get_list</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// throws bad_bvalue_access</span>

<span class="c1">// move the string out of the bvalue.</span>
<span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</pre></div>
</div>
<p>Non throwing accessors.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span><span class="p">;</span>

<span class="k">using</span> <span class="n">bv</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bencode_type</span><span class="p">;</span>

<span class="c1">// access by enum / type tag</span>
<span class="k">auto</span><span class="o">*</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">get_if</span><span class="o">&lt;</span><span class="n">bc</span><span class="o">::</span><span class="n">btype</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

<span class="c1">// access by exact type</span>
<span class="k">auto</span><span class="o">*</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">get_if</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

<span class="c1">// or the more succinct version</span>
<span class="k">auto</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">get_if_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

<span class="k">auto</span><span class="o">*</span> <span class="n">l</span> <span class="o">=</span> <span class="n">get_if_list</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// l is nullptr</span>
</pre></div>
</div>
</div>
<div class="section" id="conversion">
<h2>Conversion<a class="headerlink" href="#conversion" title="Permalink to this headline">¶</a></h2>
<p>Retrieving the value contained in a <a class="reference internal" href="../reference/bvalue.html#_CPPv4N7bencode6bvalueE" title="bencode::bvalue"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bvalue</span></code></a> as another type can be done using the
converting accessor functions.</p>
<p><code class="code docutils literal notranslate"><span class="pre">get_as&lt;T&gt;(const</span> <span class="pre">bvalue&amp;)</span></code> is a throwing converter which will throw
<a class="reference internal" href="../reference/bview.html#_CPPv4N7bencode14bad_conversionE" title="bencode::bad_conversion"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">bad_conversion</span></code></a> when the current active alternative can not be converted to the
requested type.</p>
<p><code class="code docutils literal notranslate"><span class="pre">try_get_as&lt;T&gt;(const</span> <span class="pre">bvalue&amp;)</span></code> is a non throwing converter an will return the result as a
<code class="code docutils literal notranslate"><span class="pre">nonstd::expected</span></code> type.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bencode</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">get_as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">byte</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">try_get_as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">byte</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">bytes</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do something with *bytes</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// do something with the error code: bytes.error()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-operations">
<h2>Modifying operations<a class="headerlink" href="#modifying-operations" title="Permalink to this headline">¶</a></h2>
<p>The emplace family of functions will discard the current value and construct
a new value in place forwarding the arguments to the constructor of the underlying type.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="n">b</span><span class="p">.</span><span class="n">emplace_list</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">});</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">get_list</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
<p>There are some convenience functions when the underlying type is a list or dict to directly access
the underlying type without first obtaining a reference with accessor functions.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">blist</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span><span class="p">(</span><span class="n">bc</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">});</span>
<span class="k">auto</span> <span class="n">bdict</span> <span class="o">=</span> <span class="n">bc</span><span class="o">::</span><span class="n">bdict</span><span class="p">(</span><span class="n">bc</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">dict</span><span class="p">,</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">}.</span>
    <span class="p">{</span><span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// get reference to the first element of an array</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">first</span> <span class="o">=</span> <span class="n">blist</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// change second item</span>
<span class="n">blist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// get reference to the value for key &quot;one&quot;</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">first_val</span> <span class="o">=</span> <span class="n">bdict</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">);</span>

<span class="n">first_val</span><span class="p">[</span><span class="s">&quot;one&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// append new elements</span>
<span class="n">blist</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">blist</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">bc</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">});</span>

<span class="c1">// check if there is a key &quot;one&quot;</span>
<span class="k">auto</span> <span class="n">has_one</span> <span class="o">=</span> <span class="n">bdict</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">);</span>

<span class="c1">// clear elements</span>
<span class="n">blist</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="n">bdict</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison">
<h2>Comparison<a class="headerlink" href="#comparison" title="Permalink to this headline">¶</a></h2>
<p>Comparison operators will look through the bvalue and compare with the underling type.
If the type you compare with does not match the type of the value contained in bvalue
the fallback ordering is defined by the ordering of the types:
<code class="code docutils literal notranslate"><span class="pre">integer</span> <span class="pre">&lt;</span> <span class="pre">string</span> <span class="pre">&lt;</span> <span class="pre">list</span> <span class="pre">&lt;</span> <span class="pre">dict</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b_int</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// true</span>
<span class="k">auto</span> <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>

<span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b_string</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>

<span class="c1">// true</span>
<span class="k">auto</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">b_string</span> <span class="o">&lt;</span> <span class="s">&quot;zzzz&quot;</span>

<span class="n">bc</span><span class="o">::</span><span class="n">bvalue</span> <span class="n">b_dict</span><span class="p">(</span><span class="n">bc</span><span class="o">::</span><span class="n">btype</span><span class="o">::</span><span class="n">dict</span><span class="p">,</span> <span class="p">{{</span><span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">}});</span>
<span class="k">auto</span> <span class="n">dict</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="p">({{</span><span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">}});</span>

<span class="c1">// returns true</span>
<span class="n">b_dict</span> <span class="o">==</span> <span class="n">dict</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="policies">
<h2>Policies<a class="headerlink" href="#policies" title="Permalink to this headline">¶</a></h2>
<p>The types used to store the different alternatives can be modified with the Policy template
argument.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="view.html" class="btn btn-neutral float-right" title="View interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="value_and_view.html" class="btn btn-neutral float-left" title="Value and view types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>